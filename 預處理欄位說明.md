# 欄位預處理 - 正規表達式遮罩指南

## 📋 系統說明

在「看板顯示欄位」配置表中，您可以使用「預處理」欄位來對敏感資料進行遮罩處理。預處理使用正規表達式 (Regex) 的替換功能，格式為：

```
匹配模式 → 替換結果
```

系統會自動將原始資料按照您設定的規則進行轉換，確保在前端顯示時保護隱私。

---

## 🛡️ 常用遮罩範例

### 1. 身分證字號遮罩

#### 只顯示後4碼
```regex
^.{6}(.{4})$ → ******$1
```
- **原始**: `A123456789`
- **顯示**: `******6789`
- **說明**: 前6碼用 `*` 代替，保留後4碼

#### 只顯示首字母和後3碼
```regex
^(.).*(.{3})$ → $1*****$2
```
- **原始**: `A123456789`
- **顯示**: `A*****789`
- **說明**: 保留第一個字母和最後3碼

---

### 2. 姓名遮罩

#### 中文姓名脫敏（只顯示姓氏和名字最後一字）
```regex
^(.{1}).*(.{1})$ → $1○$2
```
- **原始**: `王小明`
- **顯示**: `王○明`
- **說明**: 中間字用 `○` 代替

#### 複姓處理
```regex
^(.{2}).*(.{1})$ → $1○$2
```
- **原始**: `歐陽小美`
- **顯示**: `歐陽○美`
- **說明**: 保留複姓和最後一字

#### 英文姓名遮罩
```regex
^([A-Za-z]+)\s+.*([A-Za-z])$ → $1 ***$2
```
- **原始**: `John Smith`
- **顯示**: `John ***h`
- **說明**: 保留名字和姓氏最後一字母

---

### 3. 電話號碼遮罩

#### 手機號碼遮罩（保留前3後4碼）
```regex
^(.{4}).{3}(.{3})$ → $1***$2
```
- **原始**: `0912345678`
- **顯示**: `0912***678`

#### 市話遮罩
```regex
^(\d{2})-(\d{4})-(.{4})$ → $1-$2-****
```
- **原始**: `02-2345-6789`
- **顯示**: `02-2345-****`

---

### 4. 電子郵件遮罩

#### 帳號部分遮罩
```regex
^(.{2}).*(@.*)$ → $1***$2
```
- **原始**: `john.doe@gmail.com`
- **顯示**: `jo***@gmail.com`

#### 保留首尾字元
```regex
^(.).*(.@.*)$ → $1***$2
```
- **原始**: `student@school.edu.tw`
- **顯示**: `s***t@school.edu.tw`

---

### 5. 地址遮罩

#### 隱藏詳細地址
```regex
^(.*[市縣])(.{2,4}[區鄉鎮市]).*$ → $1$2***
```
- **原始**: `台北市大安區信義路四段123號`
- **顯示**: `台北市大安區***`

#### 只顯示縣市
```regex
^(.*[市縣]).*$ → $1***
```
- **原始**: `新北市板橋區中山路二段456號`
- **顯示**: `新北市***`

---

### 6. 學校名稱簡化

#### 移除地區前綴
```regex
^.*市立(.*)國民中學$ → $1國中
```
- **原始**: `新北市立板橋國民中學`
- **顯示**: `板橋國中`

#### 移除完整後綴
```regex
^(.*)國民中學$ → $1
```
- **原始**: `私立復興實驗高級中學附設國民中學`
- **顯示**: `私立復興實驗高級中學附設`

---

### 7. 出生日期遮罩

#### 只顯示年份
```regex
^(\d{2,4}).*$ → $1年
```
- **原始**: `1995/03/15`
- **顯示**: `1995年`

#### 年月格式
```regex
^(\d{2,4})[/-](\d{1,2}).*$ → $1年$2月
```
- **原始**: `1995-03-15`
- **顯示**: `1995年3月`

---

### 8. 成績或分數遮罩

#### 等級顯示
```regex
^([9][0-9]).*$ → A級
^([8][0-9]).*$ → B級
^([7][0-9]).*$ → C級
^.*$ → 其他
```
- **原始**: `85`
- **顯示**: `B級`

---

## 🔧 進階技巧

### 1. 條件式遮罩

針對不同長度的資料使用不同規則：

```regex
^(.{2}).*(.{2})$ → $1***$2
```
適用於4字元以上的資料

### 2. 特殊字元處理

```regex
^(.)[^@]*(@.*)$ → $1***$2
```
處理包含特殊字元的電子郵件

### 3. 數字格式化

```regex
^(\d{1,3})(\d{3})(\d{3})$ → $1,$2,$3
```
- **原始**: `1234567`
- **顯示**: `1,234,567`

---

## ⚠️ 注意事項

### 1. 語法規則
- 使用 `^` 表示字串開始，`$` 表示字串結束
- 使用 `()` 捕獲群組，在替換時用 `$1`, `$2` 引用
- 使用 `.` 匹配任意字元，`.*` 匹配任意長度字串
- 使用 `{n}` 指定確切字元數，`{n,m}` 指定範圍

### 2. 測試建議
在正式使用前，建議先用少量資料測試預處理規則是否正確。

### 3. 效能考量
複雜的正規表達式可能影響處理速度，建議使用簡潔有效的模式。

### 4. 資料完整性
確保遮罩後的資料仍能滿足業務需求，避免過度遮罩導致資訊不足。

---

## 📖 快速參考表

| 遮罩類型 | 預處理規則 | 效果 |
|---------|-----------|------|
| 身分證後4碼 | `^.{6}(.{4})$ → ******$1` | A123456789 → ******6789 |
| 姓名脫敏 | `^(.{1}).*(.{1})$ → $1○$2` | 王小明 → 王○明 |
| 手機遮罩 | `^(.{4}).{3}(.{3})$ → $1***$2` | 0912345678 → 0912***678 |
| 信箱遮罩 | `^(.{2}).*(@.*)$ → $1***$2` | john@gmail.com → jo***@gmail.com |
| 學校簡化 | `^.*市立(.*)國民中學$ → $1國中` | 台北市立中正國民中學 → 中正國中 |

---

## 🚀 實際應用範例

在「看板顯示欄位」配置表中的設定範例：

| 欄位名稱 | 欄位性質 | 特殊功能 | 預處理 | 備註 |
|---------|---------|---------|--------|------|
| 身分證統一編號 | ID | UID | `^.{6}(.{4})$ → ******$1` | 系統識別用，部分脫敏 |
| 姓名 | Text |  | `^(.{1}).*(.{1})$ → $1○$2` | 學生姓名脱敏 |
| 畢業國中名稱 | Text |  | `^.*市立(.*)國民中學$ → $1國中` | 學校名稱簡化 |
| 聯絡電話 | Text |  | `^(.{4}).{3}(.{3})$ → $1***$2` | 電話遮罩 |

透過這些預處理規則，可以在保護隱私的同時，確保前端顯示的資料既安全又實用。